<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng nhập - Cake Shop</title>

    <!-- Google Font & CSS -->
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="css/flaticon.css" type="text/css" />
    <link rel="stylesheet" href="css/barfiller.css" type="text/css" />
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />
    <link rel="stylesheet" href="css/nice-select.css" type="text/css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />

    <!-- Inline theme to match register.html (same frame and styles) -->
    <style>
      :root {--orange-50:#fff7f1;--orange-100:#ffe8d6;--orange-150:#ffeedf;--orange-200:#ffd4b0;--orange-300:#ffb374;--orange-400:#ff943d;--orange-450:#ff8624;--orange-500:#ff7a00;--orange-600:#e56700;--orange-650:#d85f00;--orange-700:#c75400;--choco:#4b2e2e;--choco-soft:#6b463c;--radius-sm:10px;--radius-md:18px;--radius-lg:26px;--radius-xl:34px;--shadow-soft:0 4px 14px -6px rgba(255,122,0,.45),0 2px 6px -2px rgba(0,0,0,.08);} 
      body { background:linear-gradient(145deg,var(--orange-50),#fff); min-height:100vh; font-family:"Montserrat",sans-serif; }
      .auth-wrapper { min-height: 70vh; display:flex; align-items:center; padding:30px 0; }
      .auth-card { margin:0 auto; max-width:520px; border:1px solid var(--orange-200); border-radius:30px; box-shadow:0 12px 34px -10px rgba(255,122,0,.45),0 4px 14px -6px rgba(0,0,0,.08); overflow:hidden; position:relative; background:linear-gradient(135deg,var(--orange-50),#fff); animation:fadeSlide .55s ease .05s both; }
      .auth-card:before {content:"";position:absolute;right:-60px;top:-60px;width:220px;height:220px;background:radial-gradient(circle at 35% 35%,var(--orange-300),transparent 70%);opacity:.25;}
      .auth-card .card-header { background:linear-gradient(110deg,var(--orange-500),var(--orange-600)); padding:22px 28px 18px; border:none; position:relative; display:flex; align-items:center; justify-content:space-between; }
      .auth-card .card-header:after { content:""; position:absolute; left:0; right:0; bottom:0; height:4px; background:rgba(255,255,255,.15); }
      .auth-card .card-header h4 { color:#fff; font-weight:700; letter-spacing:.6px; font-size:1.25rem; margin:0; display:flex; align-items:center; gap:8px; }
      .auth-card .card-header a { color:#fff !important; font-size:.85rem; display:inline-flex; align-items:center; gap:6px; font-weight:500; padding:6px 10px; border-radius:12px; background:rgba(255,255,255,.12); backdrop-filter:blur(2px); transition:.25s; }
      .auth-card .card-header a:hover { background:rgba(255,255,255,.2); color:#fff !important; text-decoration:none; }
      .auth-card .card-body { background:transparent; padding:32px 32px 32px; }
      form label.form-label { font-size:.72rem; font-weight:600; text-transform:uppercase; letter-spacing:.55px; color:#444; margin-bottom:6px; }
      .input-group { border:1px solid var(--orange-200); border-radius:18px; overflow:hidden; background:#fff; transition:.25s; }
      .input-group:focus-within { border-color:var(--orange-400); box-shadow:0 0 0 3px var(--orange-100); }
      .input-group-text { background:#fff; border:none; color:var(--orange-600); font-size:.9rem; }
      .input-group .form-control { border:none; padding:12px 14px; font-size:.95rem; }
      .input-group .form-control:focus { box-shadow:none; }
      .primary-btn, .btn.primary-btn { background:var(--orange-500); border:none; border-radius:20px; padding:15px 22px; font-size:.9rem; font-weight:700; letter-spacing:.5px; transition:.25s; box-shadow:var(--shadow-soft); }
      .primary-btn:hover { background:var(--orange-600); transform:translateY(-2px); }
      .primary-btn:active { background:var(--orange-700); transform:translateY(0); }
      a { color:var(--orange-600); }
      a:hover { color:var(--orange-700); }
      #error { font-weight:600; }
      /* Admin button (black) */
      .admin-btn { width:100%; margin-top:12px; border-radius:20px; font-weight:700; }
      .btn-dark.admin-btn { background:#222; border:none; box-shadow:var(--shadow-soft); }
      .btn-dark.admin-btn:hover { background:#111; transform:translateY(-2px); }
      .btn-dark.admin-btn:active { background:#000; transform:translateY(0); }
      @media (max-width:576px){ .auth-card {border-radius:26px;} .auth-card .card-body {padding:28px 24px 28px;} }
      @keyframes fadeSlide {from {opacity:0; transform:translateY(8px);} to {opacity:1; transform:translateY(0);} }
    </style>
  </head>
  <body>
    <div id="preloder"><div class="loader"></div></div>
    <!-- Header placeholder -->
    <div id="header-placeholder"></div>

    <main class="auth-wrapper">
      <div class="container">
        <div class="auth-card">
          <div class="card-header">
            <h4 class="mb-0">Đăng nhập</h4>
            <a href="index.html" class="text-white"><i class="fa fa-home mr-1"></i>Trang chủ</a>
          </div>
          <div class="card-body">
                <form id="login-form" novalidate>
                  <div class="mb-3">
                    <label class="form-label" for="email">Email</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="fa fa-envelope"></i></span>
                      <input id="email" type="email" class="form-control" placeholder="you@example.com" required />
                    </div>
                  </div>
                  <div class="mb-2">
                    <label class="form-label" for="password">Mật khẩu</label>
                    <div class="input-group">
                      <span class="input-group-text"><i class="fa fa-lock"></i></span>
                      <input id="password" type="password" class="form-control" placeholder="••••••••" required />
                    </div>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <div></div>
                    <a class="link-muted" href="register.html">Chưa có tài khoản?</a>
                  </div>
                  <button class="btn primary-btn w-100" type="submit">Đăng nhập</button>
                </form>
                 <button class="btn btn-dark admin-btn" id="adminLoginBtn">Đăng nhập Quản trị viên</button>
                <div id="error" class="text-danger mt-3"></div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer placeholder -->
    <div id="footer-placeholder"></div>

    <!-- JS Plugins (same order as other pages) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      window.jQuery || document.write('<script src="js/jquery-3.3.1.min.js"><\/script>');
    </script>
  <script src="js/bootstrap.min.js"></script>

  <!-- App scripts -->
  <script src="js/main.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/auth.js"></script>

    <!-- Page script: inject header/footer, init UI, and handle login -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Helper to include header/footer via fetch
        const includeHTML = (elementId, filePath, callback) => {
          fetch(filePath)
            .then(r => r.ok ? r.text() : Promise.reject('File not found'))
            .then(html => { const el = document.getElementById(elementId); if (el) el.innerHTML = html; if (callback) callback(); })
            .catch(err => { console.error('Lỗi khi tải', filePath, err); if (callback) callback(); });
        };

        // Update header counters and auth UI
        const updateCartCountInHeader = () => {
          const user = JSON.parse(localStorage.getItem('user') || 'null');
          let count = 0;
          if (user && window.Cart?.getCart) {
            try { count = (Cart.getCart() || []).reduce((s, it) => s + Number(it.qty ?? it.quantity ?? 1), 0); } catch {}
          }
          const headerCount = document.getElementById('header-cart-count');
          const offcanvasCount = document.getElementById('offcanvas-cart-count');
          if (headerCount) headerCount.textContent = count;
          if (offcanvasCount) offcanvasCount.textContent = count;
        };
        const updateUserStatus = () => {
          const user = JSON.parse(localStorage.getItem('user') || 'null');
          const headerIn = document.getElementById('header-user-loggedin');
          const headerOut = document.getElementById('header-user-loggedout');
          const offIn = document.getElementById('user-menu-loggedin');
          const offOut = document.getElementById('user-menu-loggedout');
          if (user) {
            if (headerIn && headerOut) { headerIn.style.display = 'block'; headerOut.style.display = 'none'; const nameEl = document.getElementById('header-fullname-placeholder'); if (nameEl) nameEl.textContent = user.fullname; }
            if (offIn && offOut) { offIn.style.display = 'block'; offOut.style.display = 'none'; const offName = document.getElementById('user-fullname-placeholder'); if (offName) offName.textContent = user.fullname; }
          } else {
            if (headerIn && headerOut) { headerIn.style.display = 'none'; headerOut.style.display = 'block'; }
            if (offIn && offOut) { offIn.style.display = 'none'; offOut.style.display = 'block'; }
          }
        };

        // Initialize UI after header/footer loaded
        const initUI = () => {
          if ($.fn.slicknav && $(".mobile-menu").length && !$("#mobile-menu-wrap .slicknav_menu").length) {
            $(".mobile-menu").slicknav({ prependTo: '#mobile-menu-wrap', allowParentLinks: true });
          }
          $(".canvas__open").off('click').on('click', function () { $(".offcanvas-menu-wrapper").addClass("active"); $(".offcanvas-menu-overlay").addClass("active"); });
          $(".offcanvas-menu-overlay").off('click').on('click', function () { $(".offcanvas-menu-wrapper").removeClass("active"); $(".offcanvas-menu-overlay").removeClass("active"); });
          $(".search-switch").off('click').on('click', function () { $(".search-model").fadeIn(400); });
          $(".search-close-switch").off('click').on('click', function () { $(".search-model").fadeOut(400, function () { $('#search-input').val(''); }); });
          $('.set-bg').each(function () { var bg = $(this).data('setbg'); if (bg) $(this).css('background-image', 'url(' + bg + ')'); });
          updateCartCountInHeader();
          updateUserStatus();
        };

        let loaded = 0; const afterInclude = () => { loaded++; if (loaded === 2) initUI(); };
        includeHTML('header-placeholder', 'inc/header.html', afterInclude);
        includeHTML('footer-placeholder', 'inc/footer.html', afterInclude);

        // Handle login submit
        const form = document.getElementById('login-form');
        const errorEl = document.getElementById('error');
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          errorEl.textContent = '';
          const email = document.getElementById('email').value.trim();
          const password = document.getElementById('password').value;
          try {
            Auth.login({ email, password });
            // Auth.js đã phát sự kiện authChanged; chuyển hướng về trang chủ
            window.location.href = 'index.html';
          } catch (err) {
            errorEl.textContent = err?.message || 'Đăng nhập thất bại';
          }
        });

        // Admin login navigation -> redirect to admin login page
        document.getElementById('adminLoginBtn').addEventListener('click', () => {
          window.location.href = '../admin/html/login_admin.html';
        });

        // Keep header counters up to date
        window.addEventListener('authChanged', () => { updateUserStatus(); updateCartCountInHeader(); });
        window.addEventListener('cartUpdated', updateCartCountInHeader);
      });
    </script>
  </body>
  </html>
